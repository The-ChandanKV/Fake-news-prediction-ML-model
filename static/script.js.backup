// ===== PARTICLE ANIMATION =====
function createParticles() {
    const particlesContainer = document.getElementById('particles');
    const particleCount = 50;

    for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.cssText = `
            position: absolute;
            width: ${Math.random() * 4 + 1}px;
            height: ${Math.random() * 4 + 1}px;
            background: rgba(102, 126, 234, ${Math.random() * 0.5 + 0.2});
            border-radius: 50%;
            left: ${Math.random() * 100}%;
            top: ${Math.random() * 100}%;
            animation: float ${Math.random() * 10 + 10}s linear infinite;
            animation-delay: ${Math.random() * 5}s;
        `;
        particlesContainer.appendChild(particle);
    }

    // Add CSS animation for particles
    const style = document.createElement('style');
    style.textContent = `
        @keyframes float {
            0%, 100% {
                transform: translate(0, 0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translate(${Math.random() * 200 - 100}px, ${Math.random() * 200 - 100}px);
                opacity: 0;
            }
        }
    `;
    document.head.appendChild(style);
}

// ===== COUNTER ANIMATION =====
function animateCounters() {
    const counters = document.querySelectorAll('.stat-number');

    counters.forEach(counter => {
        const target = parseInt(counter.getAttribute('data-target'));
        const duration = 2000; // 2 seconds
        const increment = target / (duration / 16); // 60fps
        let current = 0;

        const updateCounter = () => {
            current += increment;
            if (current < target) {
                counter.textContent = Math.floor(current).toLocaleString();
                requestAnimationFrame(updateCounter);
            } else {
                counter.textContent = target.toLocaleString();
            }
        };

        updateCounter();
    });
}

// ===== CHARACTER COUNTER =====
function setupCharCounter() {
    const textarea = document.getElementById('news_text');
    const charCount = document.getElementById('charCount');

    if (textarea && charCount) {
        textarea.addEventListener('input', () => {
            const count = textarea.value.length;
            charCount.textContent = count.toLocaleString();
        });
    }
}

// ===== FORM SUBMISSION =====
function setupFormSubmission() {
    const form = document.getElementById('predictionForm');
    const loadingContainer = document.getElementById('loadingContainer');
    const submitBtn = document.getElementById('submitBtn');

    if (form) {
        form.addEventListener('submit', (e) => {
            // Save current scroll position
            const scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
            sessionStorage.setItem('scrollPosition', scrollPosition);

            // Show loading animation
            if (loadingContainer) {
                loadingContainer.style.display = 'block';
            }
            if (submitBtn) {
                submitBtn.disabled = true;
                submitBtn.style.opacity = '0.6';
            }
        });
    }
}

// ===== RESTORE SCROLL POSITION =====
function restoreScrollPosition() {
    const scrollPosition = sessionStorage.getItem('scrollPosition');
    if (scrollPosition) {
        // Restore scroll position after a short delay to ensure page is loaded
        setTimeout(() => {
            window.scrollTo({
                top: parseInt(scrollPosition),
                behavior: 'instant'
            });
            sessionStorage.removeItem('scrollPosition');
        }, 100);
    }
}

// ===== RESET FORM =====
function resetForm() {
    const textarea = document.getElementById('news_text');
    const resultContainer = document.getElementById('resultContainer');
    const charCount = document.getElementById('charCount');

    if (textarea) {
        textarea.value = '';
        textarea.focus();
    }
    if (charCount) {
        charCount.textContent = '0';
    }
    if (resultContainer) {
        resultContainer.style.animation = 'slideOutDown 0.5s ease-out';
        setTimeout(() => {
            resultContainer.remove();
        }, 500);
    }

    // Scroll to prediction section
    document.getElementById('prediction').scrollIntoView({ behavior: 'smooth' });
}

// ===== SCROLL ANIMATIONS =====
function setupScrollAnimations() {
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('active');
            }
        });
    }, observerOptions);

    // Add scroll-reveal class to animated elements first
    document.querySelectorAll('.fade-in, .slide-up').forEach(el => {
        el.classList.add('scroll-reveal');
    });

    // Observe all elements with scroll-reveal class
    const scrollRevealElements = document.querySelectorAll('.scroll-reveal');
    scrollRevealElements.forEach(el => {
        observer.observe(el);

        // Immediately activate elements that are already in viewport
        const rect = el.getBoundingClientRect();
        const isInViewport = (
            rect.top >= 0 &&
            rect.left >= 0 &&
            rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
            rect.right <= (window.innerWidth || document.documentElement.clientWidth)
        );

        if (isInViewport) {
            // Add active class immediately for elements in viewport
            setTimeout(() => {
                el.classList.add('active');
            }, 100);
        }
    });
}

// ===== SMOOTH SCROLL =====
function setupSmoothScroll() {
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
}

// ===== PARALLAX EFFECT =====
function setupParallax() {
    let ticking = false;

    window.addEventListener('scroll', () => {
        if (!ticking) {
            window.requestAnimationFrame(() => {
                const scrolled = window.pageYOffset;
                const parallaxElements = document.querySelectorAll('.hero-content');

                parallaxElements.forEach(el => {
                    const speed = 0.5;
                    el.style.transform = `translateY(${scrolled * speed}px)`;
                });

                ticking = false;
            });

            ticking = true;
        }
    });
}

// ===== TYPING EFFECT FOR PLACEHOLDER =====
function setupTypingEffect() {
    const textarea = document.getElementById('news_text');
    if (!textarea) return;

    const texts = [
        "Enter the news article text here... Our AI will analyze the content and determine its authenticity.",
        "Paste any news article you want to verify...",
        "Copy and paste suspicious news content for instant verification...",
        "Enter news text to check if it's real or fake..."
    ];

    let textIndex = 0;
    let charIndex = 0;
    let isDeleting = false;
    let currentText = '';

    function type() {
        const fullText = texts[textIndex];

        if (isDeleting) {
            currentText = fullText.substring(0, charIndex - 1);
            charIndex--;
        } else {
            currentText = fullText.substring(0, charIndex + 1);
            charIndex++;
        }

        textarea.placeholder = currentText;

        let typeSpeed = isDeleting ? 30 : 50;

        if (!isDeleting && charIndex === fullText.length) {
            typeSpeed = 2000;
            isDeleting = true;
        } else if (isDeleting && charIndex === 0) {
            isDeleting = false;
            textIndex = (textIndex + 1) % texts.length;
            typeSpeed = 500;
        }

        setTimeout(type, typeSpeed);
    }

    // Only start typing effect if textarea is empty
    if (textarea.value === '') {
        setTimeout(type, 1000);
    }
}

// ===== GRADIENT ANIMATION =====
function setupGradientAnimation() {
    const style = document.createElement('style');
    style.textContent = `
        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }
    `;
    document.head.appendChild(style);
}

// ===== CURSOR TRAIL EFFECT =====
function setupCursorTrail() {
    const coords = { x: 0, y: 0 };
    const circles = document.querySelectorAll('.cursor-circle');

    if (circles.length === 0) {
        // Create cursor circles
        for (let i = 0; i < 10; i++) {
            const circle = document.createElement('div');
            circle.className = 'cursor-circle';
            circle.style.cssText = `
                position: fixed;
                width: 10px;
                height: 10px;
                border-radius: 50%;
                background: rgba(102, 126, 234, ${0.5 - i * 0.05});
                pointer-events: none;
                z-index: 9999;
                transition: transform 0.1s ease-out;
            `;
            document.body.appendChild(circle);
        }
    }

    window.addEventListener('mousemove', (e) => {
        coords.x = e.clientX;
        coords.y = e.clientY;
    });

    function animateCircles() {
        let x = coords.x;
        let y = coords.y;

        document.querySelectorAll('.cursor-circle').forEach((circle, index) => {
            circle.style.left = x - 5 + 'px';
            circle.style.top = y - 5 + 'px';
            circle.style.transform = `scale(${(10 - index) / 10})`;

            const nextCircle = document.querySelectorAll('.cursor-circle')[index + 1];
            if (nextCircle) {
                x += (parseInt(nextCircle.style.left) - x) * 0.3;
                y += (parseInt(nextCircle.style.top) - y) * 0.3;
            }
        });

        requestAnimationFrame(animateCircles);
    }

}, 100);
});

// ===== EXPORT FUNCTIONS FOR GLOBAL USE =====
window.resetForm = resetForm;

// ===== SLIDEOUT ANIMATION =====
const slideOutStyle = document.createElement('style');
slideOutStyle.textContent = `
    @keyframes slideOutDown {
        from {
            opacity: 1;
            transform: translateY(0);
        }
        to {
            opacity: 0;
            transform: translateY(30px);
        }
    }
`;
document.head.appendChild(slideOutStyle);
